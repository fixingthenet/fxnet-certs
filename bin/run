#!/bin/bash

set -e

mode=${1:-static}

if [ $mode == "dev" ]; then
  if [ ! -d ./node_modules ]; then
    yarn install
  fi
  # This file needs to be copied to /app or /admin in dev-mode
  envsubst < "/code/src/index.env.html" | tee > "/code/src/index.html" &&
  # https://github.com/webpack/watchpack/issues/25
  #touch -d "10 seconds ago" "/code/index.html" &&
  #yarn run --offline dev
  exec quasar dev mat
else
  envsubst < "/code/dist/index.html" | tee > "/usr/share/nginx/html/index.html" &&
  nginx -g "daemon off;"
fi

